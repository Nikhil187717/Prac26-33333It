import hashlib
import os

# ---------------- HASH CALCULATION ----------------
def calculate_hashes(file_path):
    md5 = hashlib.md5()
    sha256 = hashlib.sha256()

    with open(file_path, "rb") as f:
        while chunk := f.read(4096):
            md5.update(chunk)
            sha256.update(chunk)

    return md5.hexdigest(), sha256.hexdigest()


# ---------------- SUSPICIOUS STRING CHECK ----------------
def detect_suspicious_strings(file_path):
    suspicious_keywords = [
        b"cmd.exe", b"powershell", b"http://", b"https://",
        b"keylogger", b"backdoor", b"shell", b"registry"
    ]

    found = []

    with open(file_path, "rb") as f:
        data = f.read()

        for keyword in suspicious_keywords:
            if keyword in data:
                found.append(keyword.decode(errors="ignore"))

    return found


# ---------------- MAIN ANALYSIS ----------------
file_path = input("Enter file path to analyze: ").strip()

if not os.path.exists(file_path):
    print("File does not exist")
    exit()

print("\n" + "=" * 60)
print("MALWARE ANALYSIS REPORT")
print("=" * 60)

# File info
print("\nðŸ”¹ File Name:", os.path.basename(file_path))
print("ðŸ”¹ File Size:", os.path.getsize(file_path), "bytes")

# Hashes
md5_hash, sha256_hash = calculate_hashes(file_path)
print("\nðŸ”¹ MD5 Hash:", md5_hash)
print("ðŸ”¹ SHA256 Hash:", sha256_hash)

# Suspicious strings
suspicious = detect_suspicious_strings(file_path)

print("\nðŸ”¹ Suspicious Indicators:")
if suspicious:
    for s in suspicious:
        print("âš ï¸ Found:", s)
else:
    print("No suspicious strings detected")

# Risk level
print("\nðŸ”¹ Risk Assessment:")
if len(suspicious) >= 3:
    print("HIGH RISK (Likely Malicious)")
elif len(suspicious) > 0:
    print("MEDIUM RISK (Suspicious)")
else:
    print("LOW RISK (Likely Benign)")

print("\nAnalysis completed safely.")
